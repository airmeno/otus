# LESSON 7/9 (BASH)

Задача: написать скрипт для cron, который раз в час присылает на заданную почту:
- X IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
- Y запрашиваемых адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
- все ошибки c момента последнего запуска
- список всех кодов возврата с указанием их кол-ва с момента последнего запуска.

В письме должно быть прописан обрабатываемый временной диапазон, должна быть реализована защита от мультизапуска.

### Реализация 

1. Скрипт проверяет на наличие аргумента при запуске. Аргументом является e-mail адрес получателя результата работы скрипта.

Запуск из консоли:

```
# ./report.sh email@domain.com
```

Файл скрипта - [report.sh](report.sh)

2. Реализован механиз блокировки паралельного запуска скрипта, через файл блокировки

3. При запуске скрипта обрабатывается лог файл, находится строка последеней передачи информации и происходит обработка информации с указанного места.

4. Обработкой самого лога занимается другой скрипт подключаемый в родительском скрипте. Для этого были экспортированы необходимые переменные для дочернего процесса.

Файл скрипта - [script](script)

В скрипте используются функции, которые после групируются для выполнения обработки лога. Результат выгружется во временный файл, который после отработки скрипта удаляется. 

### CronTab

Для добавления задачи по расписанию редактируем:
```
# crontab -e

0 * * * * "/path_to_script/report.sh email@domain.com"
```

> *Для информации:* данный алгоритм имеет недостатки при ротации файла лога и резком наполении лога выше значений количества строк зафиксированом в специальном файле linefile. При такой ситуации будут потеряны для обработки часть строк. Если лог не ротируется, как файл из задания, то проблем не будет.
