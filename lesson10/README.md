# Lesson 10 (Proceses)

- Реализация ps ax через bash используя анализ /proc

### Решение

Решение будет состять в использовании скрипта на bash с подбором и форматировнаием информации из псевдофайловой системы /proc

1. Посмотрим вывод команды ps -ax и определим поля 
```
   PID TTY      STAT   TIME COMMAND
```

2. Основную информацию возмем из файла /proc/$pid/stat и /proc/$pid/cmdline, где pid - номер процесса

Поля:
```
PID - Номер процесса
TTY - запущенный терминал, значение 0 - терминал не запущен
STAT - состояние процесса 
TIME - проессорное время затраченное на процесс разделенное на значение процессорного такта в машинных часах 
COMMAND - имя процесса и аргументы 
```

> Дополнительно: 
Состояния процессов STAT
```
R	Выполняется. Процесс выполняется или готов к выполнению
S	Приостановлен. Процесс временно не выполняется; скорее всего, находится в ожидании определенного события, такого как нажатие клавиши или прибытие сетевого пакета
D	Приостановлен без возможности прерывания. Процесс ожидает завершения операции ввода/вывода, например, дисковым устройством
T	Остановлен. Процесс принудительно остановлен
Z	Недействующий процесс-«зомби». Это дочерний процесс, который завершился, но не был удален родителем
<	Высокоприоритетный процесс. Потребляют больше процессорного времени, оставляя меньше другим процессам
N	Низкоприоритетный процесс. Получает процессорное время в последнюю очередь
```
Значения полей /proc/pid/stat - [https://kb.novaordis.com/index.php//proc/pid/stat](https://kb.novaordis.com/index.php//proc/pid/stat)

#### Формируем скрипт 

3. Функция (перевод TIME из целого числа в сек во время 0:00): 
```
secconverttime() {
 ((m=(${1}%3600)/60))
 ((s=${1}%60))
 printf "%01d:%02d\n" $m $s
}
```
4. Переменная (значение процессорного такта в машинных часах (интевалы в сек). Нужно для расчета процессорного времени на каждый процесс):
```
clk_tck=$(getconf CLK_TCK)
```

5. Скрипт - [psax.sh](psax.sh)

6. Условие на вывод значения TTY 
```
tty* - терминалы (консоли) 
pts/* - псевдотерминалы
```

> разница между ними, в терминалах процесс читает/пишет данные в /dev/tty*, а стандартные ввод вывод клавиатура и экран. Псевдотерминал всё, что читает/пишет процесс в /dev/pts/* обрабатывается другим процессом, передаваемое ядром от одного другому процессу.

> Не получилось реализовать форматирование столбцов по выравниванию. 
