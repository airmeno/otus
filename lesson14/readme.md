# Lesson 14 (PAM)

### Запретить всем пользователям, кроме группы admin логин в выходные (суббота и воскресенье), без учета праздников.

Для решения данной задачи был использован метод проверки пользователя при подключении через скрипт. 

* [Скрипт проверки](pam.sh)

Выборка пользовталя и принадлежность к группе admin:
```
GROUP=$(groups $PAM_USER | grep -c admin)
```
результат 1 если пользователь входит в группу admin, 0 если нет.

```
if [[ $GROUP -eq 1 ]]; then 
   exit 0
  elif [[ $(date +%u) -gt 5 ]]; then
    exit 1
    else  
      exit 0 
    fi
fi
```
Если пользователь входит в группу admin, то дальнейшие проверки прекращаются, скрипт завершается с кодом 0 = true, если нет, проверяем какой день недели? Возврат в виде числа 1-7, что соотвествует: пн=1, вт=2 ... вс=7, т.е. 6-й и 7-й день выходные. Если выходной, то код возврата false, если не выходной, разрешаем вход, код вовзрата true.


* Создаем инфраструктуру для развертывания стенда

[Скрипт настроек стенда](install.sh)

Установим необходимые пакеты.

Редактируем /etc/pam.d/sshd

```
account     required       pam_exec.so    /usr/local/bin/pam.sh
```

Создаем группу admin и пользователей test1 и test2. test1 входит в группу admin, а test2 нет.

Разрешаем вход по паролю через ssh:
```
PasswordAuthentication yes
```


* Тестируем

[Image Yes](imges/1.jpg)

Как видим в среду оба пользователя получили доступ через ssh.

Для эксперимента заменим значение дня недели в скрипте pam.sh с 5 на 2 (имитация выходного дня).

[Image No](imges/2.jpg)

Пользователь test1 может подключаться через ssh, а пользователю test2 отказано в подключении.